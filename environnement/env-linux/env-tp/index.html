
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Construction de systèmes embarqués sous Linux">
      
      
      
        <link rel="canonical" href="https://mse-csel.github.io/website/environnement/env-linux/env-tp/">
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.7">
    
    
      
        <title>Travaux pratiques - Construction de systèmes embarqués sous Linux</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#environnement-linux-embarque-travaux-pratiques" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="Construction de systèmes embarqués sous Linux" class="md-header__button md-logo" aria-label="Construction de systèmes embarqués sous Linux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Construction de systèmes embarqués sous Linux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Travaux pratiques
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Construction de systèmes embarqués sous Linux" class="md-nav__button md-logo" aria-label="Construction de systèmes embarqués sous Linux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>

    </a>
    Construction de systèmes embarqués sous Linux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Accueil
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Organisation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Organisation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Organisation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../organisation/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../organisation/exam/" class="md-nav__link">
        Examens Oraux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/references/" class="md-nav__link">
        Références
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/tools/" class="md-nav__link">
        Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/microprocessor/" class="md-nav__link">
        Microprocesseur
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/nanopi/" class="md-nav__link">
        NanoPi NEO Plus2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Environnement et infrastructure
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Environnement et infrastructure" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Environnement et infrastructure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Environnement Linux embarqué
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Environnement Linux embarqué" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Environnement Linux embarqué
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../env-le/" class="md-nav__link">
        Leçon / Slides
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Travaux pratiques
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Travaux pratiques
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs" class="md-nav__link">
    Objectifs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activites" class="md-nav__link">
    Activités
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#informations-pratiques" class="md-nav__link">
    Informations pratiques
  </a>
  
    <nav class="md-nav" aria-label="Informations pratiques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-de-la-machine-hote-votre-pc" class="md-nav__link">
    Installation de la machine  hôte (votre PC)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-de-lespace-de-travail-workspace-sur-la-machine-hote-personnelle" class="md-nav__link">
    Création de l'espace de travail (workspace) sur la machine hôte personnelle
  </a>
  
    <nav class="md-nav" aria-label="Création de l'espace de travail (workspace) sur la machine hôte personnelle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-de-lenvironnement-de-developpement" class="md-nav__link">
    Configuration de l'environnement de développement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generation-et-installation-de-lenvironnement" class="md-nav__link">
    Génération et installation de l'environnement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gravure-de-la-carte-sd" class="md-nav__link">
    Gravure de la carte SD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mise-en-place-de-linfrastructure-reseau" class="md-nav__link">
    Mise en place de l'infrastructure réseau
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-de-lespace-de-travail-workspace-sous-cifssmb" class="md-nav__link">
    Mise en place de l'espace de travail (workspace) sous CIFS/SMB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generation-dapplications-sur-la-machine-de-developpement-hote" class="md-nav__link">
    Génération d'applications sur la machine de développement hôte
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-de-lapplication-sur-la-cible-vs-code" class="md-nav__link">
    Debugging de l'application sur la cible (VS-Code)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-de-lenvironnement-pour-le-developpement-du-noyau-sous-cifssmb" class="md-nav__link">
    Mise en place de l'environnement pour le développement du noyau sous CIFS/SMB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#travail" class="md-nav__link">
    Travail
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#questions" class="md-nav__link">
    Questions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Programmation Noyau
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Programmation Noyau" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Programmation Noyau
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Modules noyaux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules noyaux" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Modules noyaux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../programmation-noyau/modules/modules-le/" class="md-nav__link">
        Leçon / Slides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../programmation-noyau/modules/modules-tp/" class="md-nav__link">
        Travaux pratiques
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Pilotes de périphériques
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pilotes de périphériques" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Pilotes de périphériques
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../programmation-noyau/pilotes/pilotes-le/" class="md-nav__link">
        Leçon / Slides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../programmation-noyau/pilotes/pilotes-tp/" class="md-nav__link">
        Travaux pratiques
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs" class="md-nav__link">
    Objectifs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activites" class="md-nav__link">
    Activités
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#informations-pratiques" class="md-nav__link">
    Informations pratiques
  </a>
  
    <nav class="md-nav" aria-label="Informations pratiques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-de-la-machine-hote-votre-pc" class="md-nav__link">
    Installation de la machine  hôte (votre PC)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-de-lespace-de-travail-workspace-sur-la-machine-hote-personnelle" class="md-nav__link">
    Création de l'espace de travail (workspace) sur la machine hôte personnelle
  </a>
  
    <nav class="md-nav" aria-label="Création de l'espace de travail (workspace) sur la machine hôte personnelle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-de-lenvironnement-de-developpement" class="md-nav__link">
    Configuration de l'environnement de développement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generation-et-installation-de-lenvironnement" class="md-nav__link">
    Génération et installation de l'environnement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gravure-de-la-carte-sd" class="md-nav__link">
    Gravure de la carte SD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mise-en-place-de-linfrastructure-reseau" class="md-nav__link">
    Mise en place de l'infrastructure réseau
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-de-lespace-de-travail-workspace-sous-cifssmb" class="md-nav__link">
    Mise en place de l'espace de travail (workspace) sous CIFS/SMB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generation-dapplications-sur-la-machine-de-developpement-hote" class="md-nav__link">
    Génération d'applications sur la machine de développement hôte
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-de-lapplication-sur-la-cible-vs-code" class="md-nav__link">
    Debugging de l'application sur la cible (VS-Code)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mise-en-place-de-lenvironnement-pour-le-developpement-du-noyau-sous-cifssmb" class="md-nav__link">
    Mise en place de l'environnement pour le développement du noyau sous CIFS/SMB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#travail" class="md-nav__link">
    Travail
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#questions" class="md-nav__link">
    Questions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="environnement-linux-embarque-travaux-pratiques">Environnement Linux embarqué / Travaux pratiques</h1>
<h2 id="objectifs">Objectifs</h2>
<p>Ce travail pratique vise les objectifs suivants :</p>
<ul>
<li>Mise en œuvre d&rsquo;un système embarqué sous Linux</li>
<li>Mise en œuvre de l&rsquo;environnement de développement de systèmes embarqués sous Linux avec Docker</li>
<li>Debugging d&rsquo;applications sous Linux embarqué</li>
<li>Mise en production d&rsquo;un système embarqué sous Linux</li>
</ul>
<h2 id="activites">Activités</h2>
<p>Il comprendra les activités suivantes :</p>
<ol>
<li>Mise œuvre de l&rsquo;environnement de développement sous Linux (avec Docker)<ol>
<li>Installation de la machine hôte</li>
<li>Création de l&rsquo;espace de travail sur la machine hôte</li>
<li>Génération de l&rsquo;environnement de développement (toolchain, U-Boot, Linux kernel, rootfs)</li>
</ol>
</li>
<li>Mise en œuvre de l&rsquo;infrastructure (cible, machine hôte)<ol>
<li>Mise en place de l&rsquo;infrastructure</li>
<li>Gravure (burning) de la carte SD pour la cible</li>
<li>Test de l&rsquo;environnement de production sous carte SD</li>
<li>Test de l&rsquo;environnement de développement sous cifs (smb)</li>
</ol>
</li>
<li>Debugging d&rsquo;une application simple depuis la machine hôte<ol>
<li>Génération d&rsquo;une application sur la machine hôte</li>
<li>Lancement de l&rsquo;application sur la cible</li>
<li>Debugging de l&rsquo;application avec VS-Code et SSH</li>
</ol>
</li>
<li>Mise en production<ol>
<li>Génération d&rsquo;une application</li>
<li>Génération du rootfs avec l&rsquo;application</li>
<li>Test et validation du produit</li>
</ol>
</li>
</ol>
<h2 id="informations-pratiques">Informations pratiques</h2>
<p>Ce paragraphe donne quelques informations utiles pour la réalisation de ce travail pratique.</p>
<h3 id="installation-de-la-machine-hote-votre-pc">Installation de la machine  hôte (votre PC)</h3>
<p>Pour les exercices, nous utilisons des conteneurs Docker. Si vous n&rsquo;avez pas encore installé Docker Desktop,
téléchargez-le depuis le <a href="https://www.docker.com/products/docker-desktop">site officiel de Docker</a> et installez-le.</p>
<p>Installez <a href="https://git-scm.com/downloads">git</a> sur votre machine si ce n&rsquo;est pas déjà fait. Configurez aussi l&rsquo;utilisateur
de git:</p>
<div class="highlight"><pre><span></span><code>git config --global user.name &quot;User Name&quot;
git config --global user.email user.name@master.hes-so.ch
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48L3 12m17-9v8.75l-10 .15V5.21L20 3M3 13l6 .09v6.81l-6-1.15V13m17 .25V22l-10-1.91V13.1l10 .15z"/></svg></span></p>
<p>Sur les machines Windows, il est encore nécessaire de configurer Git pour qqu&rsquo;il utilise le &ldquo;line ending&rdquo; de Linux (<code>\n</code>),
car les scripts &ldquo;bash&rdquo; n&rsquo;autorisant pas le &ldquo;line ending&rdquo; DOS (<code>\r\n</code>).</p>
<div class="highlight"><pre><span></span><code>git config --global core.autocrlf false
</code></pre></div>
</div>
<p>Installez aussi <a href="https://code.visualstudio.com/">Visual Studio Code</a> si ce n&rsquo;est pas déjà fait.</p>
<h2 id="creation-de-lespace-de-travail-workspace-sur-la-machine-hote-personnelle">Création de l&rsquo;espace de travail (workspace) sur la machine hôte personnelle</h2>
<p>Avec notre browser, rendez vous sur le dépôt <a href="https://github.com/supcik/csel-workspace">csel-workspace</a>
et faites un <em>fork</em> dans l&rsquo;espace de travail personnel de github d&rsquo;un membre du groupe.</p>
<p>Ajoutez les autres membres du groupe avec le rôle &ldquo;Write&rdquo;, &ldquo;Maintain&rdquo; ou &ldquo;Admin&rdquo;. Ajouter aussi
le(s) professeur(s) avec au minimum le rôle &ldquo;Triage&rdquo;.</p>
<p>Chaque membre de l&rsquo;équipe peut maintenant faire un &ldquo;Clone&rdquo; du projet <em>csel-workspace</em> sur son ordinateur. </p>
<h3 id="configuration-de-lenvironnement-de-developpement">Configuration de l&rsquo;environnement de développement</h3>
<p>Ouvrez le projet avec VSCode. Le système vous demandera probablement si vous faites confiance
aux auteurs de ce dossier et vous pouvez cliquer sur le bouton correspondant.</p>
<p>Si le système vous propose de ré-ouvrir le dossier dans un container, acceptez cette
proposition en cliquant sur &ldquo;Reopen in Container&rdquo;</p>
<p>Lorsque vous ouvrez le projet avec VSCode, le système vous proposera probablement d&rsquo;installer des extensions.
Acceptez-les toutes et cliquez sur le bouton &ldquo;Install&rdquo;.</p>
<p>Ouvrez maintenant un terminal dans VSCode et téléchargez &ldquo;buildroot&rdquo; avec la commande suivante:</p>
<div class="highlight"><pre><span></span><code>get-buildroot.sh 
</code></pre></div>
<p>Pour votre culture génlrale, étudiez le script <code>get-buildroot.sh</code> dans <code>/usr/local/bin/</code>.</p>
<h3 id="generation-et-installation-de-lenvironnement">Génération et installation de l&rsquo;environnement</h3>
<p>Vous pouvez modifier la configuration du noyau ou du rootfs avec la commande suivante :</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">cd</span> /buildroot
make menuconfig
</code></pre></div>
Générez ensuite les différents packages et créez les images. </p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /buildroot
make
</code></pre></div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>La construction du système prend entre 30 et 60 minutes selon la
performance de votre PC. Assurez-vous aussi d&rsquo;avoir au moins <strong>20GiB
de libre</strong> sur votre disque dur (ou ssd).</p>
</div>
<p>Actualisez maintenant le &ldquo;root filesystem&rdquo;:</p>
<div class="highlight"><pre><span></span><code>rm -Rf /rootfs/*
tar xf /buildroot/output/images/rootfs.tar -C /rootfs
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez aussi utiliser les script <code>/usr/local/bin/delete-rootfs.sh</code> 
et <code>/usr/local/bin/extract-rootfs.sh</code> présents dans l&rsquo;image Docker.</p>
</div>
<h3 id="gravure-de-la-carte-sd">Gravure de la carte SD</h3>
<p>Avant de pouvoir graver la carte SD, vous devez copier les images dans le répertoire synchronisé avec votre ordinateur.
Vous pouvez utiliser la commande <code>rsync</code> :</p>
<div class="highlight"><pre><span></span><code>rsync -rlt --progress --delete /buildroot/output/images/ /workspace/buildroot-images
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez aussi utiliser le script <code>/usr/local/bin/sync-images.sh</code> présent dans l&rsquo;image Docker.</p>
</div>
<p>Pour graver la carte SD, utilisez le logiciel <a href="https://www.balena.io/etcher/">Balena Etcher</a>.
Insérez la carte SD dans votre ordinateur, sélectionnez l&rsquo;image <code>buildroot-images/sdcard.img</code>, sélectionnez le disque qui correspond
à votre carte SD et cliquez sur &ldquo;Flash!&rdquo;.</p>
<figure>
<p><img alt="Etcher" src="../img/etcher.png" /></p>
<figcaption>Ecriture de la carte SD</figcaption>
</figure>
<p>Pour tester la bonne gravure de la carte SD, il suffira de l&rsquo;installer sur la cible et de la redémarrer.
On pourra voir la séquence de lancement (boot sequence) sur la console avec un client &ldquo;terminal série&rdquo; installé sur l&rsquo;hôte. Vous pouvez
utiliser par exemple:</p>
<ul>
<li><a href="https://freeware.the-meiers.org/" target="_blank">Coolterm</a> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48L3 12m17-9v8.75l-10 .15V5.21L20 3M3 13l6 .09v6.81l-6-1.15V13m17 .25V22l-10-1.91V13.1l10 .15z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.62 8.35c-.42.28-1.75 1.04-1.95 1.19-.39.31-.75.29-1.14-.01-.2-.16-1.53-.92-1.95-1.19-.48-.31-.45-.7.08-.92 1.64-.69 3.28-.64 4.91.03.49.21.51.6.05.9m7.22 7.28c-.93-2.09-2.2-3.99-3.84-5.66a4.31 4.31 0 0 1-1.06-1.88c-.1-.33-.17-.67-.24-1.01-.2-.88-.29-1.78-.7-2.61-.73-1.58-2-2.4-3.84-2.47-1.81.05-3.16.81-3.95 2.4-.21.43-.36.88-.46 1.34-.17.76-.32 1.55-.5 2.32-.15.65-.45 1.21-.96 1.71-1.61 1.57-2.9 3.37-3.88 5.35-.14.29-.28.58-.37.88-.19.66.29 1.12.99.96.44-.09.88-.18 1.3-.31.41-.15.57-.05.67.35.65 2.15 2.07 3.66 4.24 4.5 4.12 1.56 8.93-.66 9.97-4.58.07-.27.17-.37.47-.27.46.14.93.24 1.4.35.49.09.85-.16.92-.64.03-.26-.06-.49-.16-.73"/></svg></span></li>
<li><a href="https://ttssh2.osdn.jp/index.html.en" target="_blank">Tera Term</a> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48L3 12m17-9v8.75l-10 .15V5.21L20 3M3 13l6 .09v6.81l-6-1.15V13m17 .25V22l-10-1.91V13.1l10 .15z"/></svg></span></li>
<li><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/" target="_blank">Putty</a> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48L3 12m17-9v8.75l-10 .15V5.21L20 3M3 13l6 .09v6.81l-6-1.15V13m17 .25V22l-10-1.91V13.1l10 .15z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.62 8.35c-.42.28-1.75 1.04-1.95 1.19-.39.31-.75.29-1.14-.01-.2-.16-1.53-.92-1.95-1.19-.48-.31-.45-.7.08-.92 1.64-.69 3.28-.64 4.91.03.49.21.51.6.05.9m7.22 7.28c-.93-2.09-2.2-3.99-3.84-5.66a4.31 4.31 0 0 1-1.06-1.88c-.1-.33-.17-.67-.24-1.01-.2-.88-.29-1.78-.7-2.61-.73-1.58-2-2.4-3.84-2.47-1.81.05-3.16.81-3.95 2.4-.21.43-.36.88-.46 1.34-.17.76-.32 1.55-.5 2.32-.15.65-.45 1.21-.96 1.71-1.61 1.57-2.9 3.37-3.88 5.35-.14.29-.28.58-.37.88-.19.66.29 1.12.99.96.44-.09.88-.18 1.3-.31.41-.15.57-.05.67.35.65 2.15 2.07 3.66 4.24 4.5 4.12 1.56 8.93-.66 9.97-4.58.07-.27.17-.37.47-.27.46.14.93.24 1.4.35.49.09.85-.16.92-.64.03-.26-.06-.49-.16-.73"/></svg></span></li>
<li><a href="https://www.gnu.org/software/screen/" target="_blank">GNU screen</a> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.62 8.35c-.42.28-1.75 1.04-1.95 1.19-.39.31-.75.29-1.14-.01-.2-.16-1.53-.92-1.95-1.19-.48-.31-.45-.7.08-.92 1.64-.69 3.28-.64 4.91.03.49.21.51.6.05.9m7.22 7.28c-.93-2.09-2.2-3.99-3.84-5.66a4.31 4.31 0 0 1-1.06-1.88c-.1-.33-.17-.67-.24-1.01-.2-.88-.29-1.78-.7-2.61-.73-1.58-2-2.4-3.84-2.47-1.81.05-3.16.81-3.95 2.4-.21.43-.36.88-.46 1.34-.17.76-.32 1.55-.5 2.32-.15.65-.45 1.21-.96 1.71-1.61 1.57-2.9 3.37-3.88 5.35-.14.29-.28.58-.37.88-.19.66.29 1.12.99.96.44-.09.88-.18 1.3-.31.41-.15.57-.05.67.35.65 2.15 2.07 3.66 4.24 4.5 4.12 1.56 8.93-.66 9.97-4.58.07-.27.17-.37.47-.27.46.14.93.24 1.4.35.49.09.85-.16.92-.64.03-.26-.06-.49-.16-.73"/></svg></span></li>
<li><a href="https://salsa.debian.org/minicom-team/minicom" target="_blank">minicom</a> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.62 8.35c-.42.28-1.75 1.04-1.95 1.19-.39.31-.75.29-1.14-.01-.2-.16-1.53-.92-1.95-1.19-.48-.31-.45-.7.08-.92 1.64-.69 3.28-.64 4.91.03.49.21.51.6.05.9m7.22 7.28c-.93-2.09-2.2-3.99-3.84-5.66a4.31 4.31 0 0 1-1.06-1.88c-.1-.33-.17-.67-.24-1.01-.2-.88-.29-1.78-.7-2.61-.73-1.58-2-2.4-3.84-2.47-1.81.05-3.16.81-3.95 2.4-.21.43-.36.88-.46 1.34-.17.76-.32 1.55-.5 2.32-.15.65-.45 1.21-.96 1.71-1.61 1.57-2.9 3.37-3.88 5.35-.14.29-.28.58-.37.88-.19.66.29 1.12.99.96.44-.09.88-.18 1.3-.31.41-.15.57-.05.67.35.65 2.15 2.07 3.66 4.24 4.5 4.12 1.56 8.93-.66 9.97-4.58.07-.27.17-.37.47-.27.46.14.93.24 1.4.35.49.09.85-.16.92-.64.03-.26-.06-.49-.16-.73"/></svg></span></li>
</ul>
<p>Voici ce que vous devriez voir sur la console :</p>
<figure>
<p><img alt="Boot début" src="../img/boot_start.png" /></p>
<figcaption>Début de la séquence de boot</figcaption>
</figure>
<p>Lorsque la séquece de boot termine, vous pouvez vous connecter avec le login <code>root</code> :</p>
<figure>
<p><img alt="Boot fin" src="../img/boot_end.png" /></p>
<figcaption>Fin de la séquence de boot</figcaption>
</figure>
<h3 id="mise-en-place-de-linfrastructure-reseau">Mise en place de l&rsquo;infrastructure réseau</h3>
<p>Pour simplifier le développement et la réalisation des différents travaux pratiques de ce cours, il est recommandé de configurer l&rsquo;ensemble de l&rsquo;infrastructure réseau avec des adresses IP statiques.
On utilisera de préférence, l&rsquo;adresse IP <em>192.168.0.14</em> pour la cible et l&rsquo;adresse IP <em>192.168.0.4</em> pour la machine hôte de développement.</p>
<p>L&rsquo;image de la cible est déjà configurée avec l&rsquo;adresse <em>192.168.0.14</em>. Configurez maintenant l&rsquo;adaptateur Ethernet de votre PC (ou un adaptateur Ethernet/USB) avec l&rsquo;adresse IP fixe <em>192.168.0.4</em> :</p>
<figure>
<p><img alt="Configuration de l'adresse IP" src="../img/static_ip.png" /></p>
<figcaption>Configuration de l'adresse IP statique</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48L3 12m17-9v8.75l-10 .15V5.21L20 3M3 13l6 .09v6.81l-6-1.15V13m17 .25V22l-10-1.91V13.1l10 .15z"/></svg></span></p>
<p>Si vous travaillez avec Windows, vous devez encore configurer le firewall pour permettre les connexions provenant
du réseau <em>192.168.0.0/24</em>.</p>
</div>
<p>Reliez l&rsquo;adaptateur Ethernet de votre PC avec la cible à l&rsquo;aide du câble Ethernet et, depuis une console de votre PC, testez la connexion :</p>
<div class="highlight"><pre><span></span><code>ping 192.168.0.14
</code></pre></div>
<p>Vous devriez obtenir quelque chose comme ça:</p>
<div class="highlight"><pre><span></span><code>PING 192.168.0.14 (192.168.0.14): 56 data bytes
64 bytes from 192.168.0.14: icmp_seq=0 ttl=64 time=2.933 ms
64 bytes from 192.168.0.14: icmp_seq=1 ttl=64 time=0.832 ms
64 bytes from 192.168.0.14: icmp_seq=2 ttl=64 time=0.783 ms
64 bytes from 192.168.0.14: icmp_seq=3 ttl=64 time=0.751 ms
64 bytes from 192.168.0.14: icmp_seq=4 ttl=64 time=0.845 ms
</code></pre></div>
<p>Si vous obtenez le résultat ci-dessous, c&rsquo;est que la connexion ne passe pas :</p>
<div class="highlight"><pre><span></span><code>PING 192.168.0.14 (192.168.0.14): 56 data bytes
ping: sendto: Host is down
Request timeout for icmp_seq 0
ping: sendto: Host is down
Request timeout for icmp_seq 1
ping: sendto: Host is down
Request timeout for icmp_seq 2
ping: sendto: Host is down
Request timeout for icmp_seq 3
</code></pre></div>
<p>Connectez-vous maintenant à la cible depuis votre PC par SSH:</p>
<div class="highlight"><pre><span></span><code>ssh root@192.168.0.14
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si la clé SSH de la cible a changé, vous verrez quelque chose comme ça:</p>
<div class="highlight"><pre><span></span><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
...
</code></pre></div>
<p>Dans ce cas, effacez les entrées dans votre fichier <code>known_hosts</code> avec
la commande suivante:</p>
<div class="highlight"><pre><span></span><code>ssh-keygen -R  192.168.0.14
</code></pre></div>
<p>et essayez à nouveau.</p>
</div>
<p>Si tout va bien, vous verrez un message du genre :</p>
<div class="highlight"><pre><span></span><code>The authenticity of host &#39;192.168.0.14&#39; can&#39;t be established.
ED25519 key fingerprint is SHA256:...
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre></div>
<p>Entrez <code>yes</code> et pressez <span class="keys"><kbd class="key-enter">Enter</kbd></span></p>
<p>Vous êtes maintenant connecté! Tapez la commande <code>uname -a</code> pour voir le système d&rsquo;exploitation de la cible :</p>
<div class="highlight"><pre><span></span><code># uname -a
Linux csel 5.15.21 #1 SMP PREEMPT Sat Feb 12 19:26:27 UTC 2022 aarch64 GNU/Linux
</code></pre></div>
<h2 id="mise-en-place-de-lespace-de-travail-workspace-sous-cifssmb">Mise en place de l&rsquo;espace de travail (<em>workspace</em>) sous CIFS/SMB</h2>
<p>Il est possible d&rsquo;augmenter le confort de travail et l&rsquo;efficacité en attachant l&rsquo;espace de travail de la machine de développement hôte directement sur la cible.
Ceci permet en effet d&rsquo;accéder directement depuis la cible les fichiers et applications générés sur la machine hôte, évitant ainsi des copies inutiles de fichiers.
Il est possible d&rsquo;attacher l&rsquo;espace de travail soit manuellement soit automatiquement. </p>
<p>Pour attacher manuellement l&rsquo;espace de travail de la machine hôte sur la cible via CIFS/SMB, il faut :</p>
<ul>
<li>Se logger sur la cible (username : « root » et password : lasser vide)</li>
<li>Créer la première fois un point d&rsquo;attachement sur la cible :
  <div class="highlight"><pre><span></span><code>mkdir -p /workspace
</code></pre></div></li>
<li>Attacher le workspace de la machine hôte sur la cible :
  <div class="highlight"><pre><span></span><code>mount -t cifs -o vers=1.0,username=root,password=toor,port=1445,noserverino //192.168.0.4/workspace /workspace
</code></pre></div></li>
<li>Détacher le workspace de la cible :
  <div class="highlight"><pre><span></span><code>umount /workspace
</code></pre></div></li>
</ul>
<p>Pour attacher automatiquement l&rsquo;espace de travail de la machine hôte sur la cible via CIFS/SMB, il suffit d&rsquo;effectuer une seule fois les instructions ci-dessous :</p>
<ul>
<li>Créer la première fois un point d&rsquo;attachement sur la cible, p. ex. :
  <div class="highlight"><pre><span></span><code>mkdir -p /workspace
</code></pre></div></li>
<li>Editer le ficher &ldquo;/etc/fstab&rdquo; (avec vi) et ajouter la ligne ci-dessous :
  <div class="highlight"><pre><span></span><code>//192.168.0.4/workspace /workspace cifs vers=1.0,username=root,password=toor,port=1445,noserverino
</code></pre></div></li>
<li>Activer la configuration :
  <div class="highlight"><pre><span></span><code>mount -a
</code></pre></div></li>
</ul>
<h2 id="generation-dapplications-sur-la-machine-de-developpement-hote">Génération d&rsquo;applications sur la machine de développement hôte</h2>
<p>Pour la génération d&rsquo;applications sur la machine hôte (compilation croisée),
il est recommandé de développer ces propres <code>Makefile</code>.
Quelques infos utiles pour trouver la <em>toolchain</em> et éditer le <code>Makefile</code> :</p>
<div class="highlight"><pre><span></span><code><span class="c"># Makefile toolchain part</span>
<span class="nv">TOOLCHAIN_PATH</span><span class="o">=</span>/buildroot/output/host/usr/bin/
<span class="nv">TOOLCHAIN</span><span class="o">=</span><span class="k">$(</span>TOOLCHAIN_PATH<span class="k">)</span>aarch64-linux-

<span class="c"># Makefile common part</span>
<span class="nv">CC</span><span class="o">=</span><span class="k">$(</span>TOOLCHAIN<span class="k">)</span>gcc
<span class="nv">LD</span><span class="o">=</span><span class="k">$(</span>TOOLCHAIN<span class="k">)</span>gcc
<span class="nv">AR</span><span class="o">=</span><span class="k">$(</span>TOOLCHAIN<span class="k">)</span>ar
<span class="nv">CFLAGS</span><span class="o">+=</span>-Wall -Wextra -g -c -mcpu<span class="o">=</span>cortex-a53 -O0 -MD -std<span class="o">=</span>gnu11
</code></pre></div>
<h2 id="debugging-de-lapplication-sur-la-cible-vs-code">Debugging de l&rsquo;application sur la cible (VS-Code)</h2>
<p>Le debugging d&rsquo;application peut être effectué de deux manières :</p>
<ul>
<li>directement sur la cible avec &ldquo;gdb&rdquo;</li>
<li>à distance en utilisant un &ldquo;gdbserver&rdquo; sur la cible et &ldquo;gdb&rdquo; sur la machine hôte</li>
</ul>
<p>Cette dernière option offre l&rsquo;avantage de pouvoir utiliser VS-Code.</p>
<p>Visual Studio Code avec ses extensions et les &ldquo;multi-root workspaces&rdquo; offre une interface très simple
et un debugger de qualité pour le debugging de vos applications. Pour configurer VS-Code, il suffit trois fichiers:</p>
<ul>
<li>Un fichier &ldquo;workspace&rdquo;</li>
<li>Un fichier &ldquo;task&rdquo;</li>
<li>Un fichier &ldquo;launcher&rdquo;</li>
</ul>
<p>Ces fichiers sont déjà configurés dans votre workspace.</p>
<p>Les fichiers “task” (task.json) et “launcher” (launch.json) se trouvent du répertoire .vscode de chaque projet, soit dans les répertoires /workspace/src/samples/tp.01/debug/.vscode et /workspace/src/samples/tp.01/coredump/.vscode.</p>
<h2 id="mise-en-place-de-lenvironnement-pour-le-developpement-du-noyau-sous-cifssmb">Mise en place de l&rsquo;environnement pour le développement du noyau sous CIFS/SMB</h2>
<p>Pour le développement de modules et de pilotes de périphériques devant fonctionner dans le noyau Linux, il est généralement plus commode de charger le noyau de la machine hôte sur la cible et d&rsquo;accéder le <em>rootfs</em> fraîchement généré ou modifié directement via le réseau. </p>
<p>Pour ce faire, il faut créer un nouveau fichier de configuration (p.ex. <code>boot.cifs</code>) pour l&rsquo;U-Boot, et le copier sur la carte SD dans la partition vfat <code>boot</code>. Pour créer ce fichier, il faut tout d&rsquo;abord éditer un fichier avec les variables et commandes nécessaire à l&rsquo;U-Boot :</p>
<ul>
<li>Créer un dossier <code>boot-scripts</code> dans le <em>workspace</em></li>
<li>Ouvrir/créer le fichier de commandes <code>boot_cifs.cmd</code> et l&rsquo;ouvrir avec VS-Code</li>
<li>Entrer le contenu suivant :
  <div class="highlight"><pre><span></span><code>setenv myip        192.168.0.14
setenv serverip    192.168.0.4
setenv netmask     255.255.255.0
setenv gatewayip   192.168.0.4
setenv hostname    myhost
setenv mountpath   rootfs
setenv bootargs    console=ttyS0,115200 earlyprintk rootdelay=1 root=/dev/cifs rw cifsroot=//$serverip/$mountpath,username=root,password=toor,port=1445 ip=$myip:$serverip:$gatewayip:$netmask:$hostname::off

fatload mmc 0 $kernel_addr_r Image
fatload mmc 0 $fdt_addr_r nanopi-neo-plus2.dtb

booti $kernel_addr_r - $fdt_addr_r
</code></pre></div></li>
<li>Ecrire aussi le <code>Makefile</code> suivant:
  <div class="highlight"><pre><span></span><code><span class="nf">boot.cifs</span><span class="o">:</span> <span class="n">boot_cifs</span>.<span class="n">cmd</span>
	mkimage -T script -A arm -C none -d boot_cifs.cmd boot.cifs
</code></pre></div></li>
<li>Dans un terminal, entrer dans le dossier <code>boot-scripts</code> et taper la command <code>make</code>
  Vous devriez obtenir le fichier <code>boot.cifs</code> dans le dossier <code>boot-scripts</code></li>
<li>Copier le fichier <code>boot.cifs</code> sur la partition vfat <code>boot</code> de la carte SD</li>
<li>Redémarer la cible et l&rsquo;arrêter dans l&rsquo;U-Boot (en pressant une touche au démarrage) et changer le script de démarrage de la cible
  avec la commande <code>setenv boot_scripts boot.cifs</code>. Si vous souhaitez conserver cette configuration, taper également la commande <code>saveenv</code>
  <img alt="configuration U-Boot" src="../img/boot_env.png" /></li>
<li>Relancer le système / redémarrer la cible (avec la commande <code>boot</code>)</li>
</ul>
<p>Lors du premier démarrage sur le réseau, la cible va générer de nouvelles clés SSH et c&rsquo;est possible que les
permissions de ces clés soient mal configurées. Vous verrez alors des messages de ce genre sur la console:</p>
<div class="highlight"><pre><span></span><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0666 for &#39;/etc/ssh/ssh_host_&lt;NAME&gt;_key&#39; are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
</code></pre></div>
<p>Connectez-vous alors sur la console (<code>root</code>) et tapez la commande suivante:</p>
<div class="highlight"><pre><span></span><code>chmod go= /etc/ssh/*_key
</code></pre></div>
<p>Redémarrez avec un <code>reboot</code> et vérifiez que vous pouvez maintenant vous connecter avec SSH.</p>
<h2 id="travail">Travail</h2>
<ol>
<li>Installez l&rsquo;environnement de développement sur la machine hôte, selon les instructions ci-dessus, et configurez la cible en mode de développement avec CIFS/SMB.</li>
<li>Installez/configurez SSH pour un accès à distance.</li>
<li>Créez un script permettant de générer la carte SD.</li>
<li>Testez les différentes méthodes et techniques de débogage proposées par l&rsquo;environnement Linux. Pour cela, générez les exemples fournis dans le répertoire
   &ldquo;~/workspace/csel1/environment&rdquo; en suivant les indications des slides. Ces fichiers se trouvent également sous Moodle.</li>
<li>Créez une partition <em>ext4</em> avec l&rsquo;espace restant sur la carte SD (avec les commandes <code>fdisk /dev/mmcblk2</code> et <code>mkfs.ext4</code>) et montez ce répertoire sous <code>/opt</code>.
  Démarrez ensuite automatiquement (mode production) un petit programme que vous aurez préalablement placé dans <code>/opt</code>.</li>
<li>Répondez aux questions </li>
</ol>
<h2 id="questions">Questions</h2>
<ol>
<li>Comment faut-il procéder pour générer l&rsquo;U-Boot ?</li>
<li>Comment peut-on ajouter et générer un package supplémentaire dans le Buildroot ?</li>
<li>Comment doit-on procéder pour modifier la configuration du noyau Linux ?</li>
<li>Comment faut-il faire pour générer son propre rootfs ?</li>
<li>Comment faudrait-il procéder pour utiliser la carte eMMC en lieu et place de la carte SD ?</li>
<li>Dans le support de cours, on trouve différentes configurations de l&rsquo;environnement de développement. Qu&rsquo;elle serait la configuration optimale pour le développement uniquement d&rsquo;applications en espace utilisateur ?</li>
</ol>
<hr />
<div class="admonition note">
<p class="admonition-title">Archives 2021/2022</p>
<ul>
<li><a href="../assets/sp.02.2_mas_csel_environnement_linux_embarque_exercices.pdf">Exercices</a></li>
<li><a href="../assets/sp.02.3_mas_csel_examples.tar">Code</a></li>
</ul>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Pied de page">
      
        
        <a href="../env-le/" class="md-footer__link md-footer__link--prev" aria-label="Précédent: Leçon / Slides" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Précédent
              </span>
              Leçon / Slides
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../programmation-noyau/modules/modules-le/" class="md-footer__link md-footer__link--next" aria-label="Suivant: Leçon / Slides" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Suivant
              </span>
              Leçon / Slides
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Haute école d'ingénierie et d'architecture of Fribourg
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/mse-csel/website" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.sections"], "translations": {"clipboard.copy": "Copier dans le presse-papier", "clipboard.copied": "Copi\u00e9 dans le presse-papier", "search.config.lang": "fr", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Rechercher", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.term.missing": "Non trouv\u00e9", "select.version.title": "S\u00e9lectionner la version"}, "search": "../../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>